<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Analisador Instagram - Modo F√°cil</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #fafafa; color: #262626; }
        .container { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        h1 { color: #E1306C; margin-bottom: 5px; font-size: 1.8em; text-align: center; }
        .subtitle { text-align: center; color: #666; font-size: 0.9em; margin-bottom: 30px; }
        
        /* Estilo dos Passos */
        .step { margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 25px; }
        .step:last-child { border: none; }
        .step-title { font-weight: 800; font-size: 1.1em; margin-bottom: 15px; display: flex; align-items: center; color: #262626; }
        .step-number { background: #E1306C; color: white; width: 28px; height: 28px; border-radius: 50%; display: inline-flex; justify-content: center; align-items: center; font-size: 0.9em; margin-right: 10px; flex-shrink: 0; font-weight: bold;}
        
        /* Tutorial Box */
        .tutorial-list { font-size: 0.95em; color: #444; line-height: 1.5; padding-left: 10px; }
        .tutorial-list li { margin-bottom: 8px; }
        .config-card { background: #f0f2f5; border-left: 4px solid #E1306C; padding: 15px; border-radius: 4px; margin: 15px 0; font-size: 0.9em; }
        .config-item { display: flex; justify-content: space-between; margin-bottom: 6px; border-bottom: 1px solid #ddd; padding-bottom: 6px;}
        .config-item:last-child { border: none; margin: 0; padding: 0; }
        .config-label { color: #666; }
        .config-value { font-weight: bold; color: #000; }
        
        /* Bot√£o Link Direto */
        .btn-insta { display: block; width: 100%; text-align: center; background: #E1306C; color: white; text-decoration: none; padding: 14px; border-radius: 8px; font-weight: 700; font-size: 1em; margin-top: 15px; transition: 0.2s; box-sizing: border-box; }
        .btn-insta:hover { background: #c1275c; }

        /* √Årea de Upload Unificada */
        .upload-zone { border: 2px dashed #ccc; background: #fff; border-radius: 10px; padding: 40px 20px; cursor: pointer; transition: 0.3s; position: relative; text-align: center; }
        .upload-zone:hover { border-color: #E1306C; background: #fff5f8; }
        .upload-zone p { margin: 0; color: #666; font-weight: 600; }
        .upload-zone input { position: absolute; width: 100%; height: 100%; top: 0; left: 0; opacity: 0; cursor: pointer; }

        /* Resultados */
        #results { display: none; margin-top: 20px; animation: fadeIn 0.5s; }
        .stats { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; }
        .stat-card { background: #f8f8f8; padding: 15px 10px; border-radius: 8px; flex: 1; text-align: center; }
        .stat-val { font-size: 1.5em; font-weight: 800; color: #E1306C; line-height: 1; }
        .stat-label { font-size: 0.75em; color: #666; margin-top: 5px; text-transform: uppercase; letter-spacing: 0.5px; }

        ul { list-style: none; padding: 0; text-align: left; max-height: 400px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; }
        li { padding: 12px 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        li:hover { background-color: #f9f9f9; }
        a.profile-link { color: #0095f6; text-decoration: none; font-weight: 600; font-size: 0.85em; background: #eef7ff; padding: 4px 10px; border-radius: 4px; }

        .loading { display: none; color: #666; font-style: italic; margin-top: 10px; text-align: center; }
        .error-msg { color: #d32f2f; background: #ffebee; padding: 10px; border-radius: 6px; font-size: 0.9em; display: none; margin-top: 10px; text-align: center; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <h1>Analisador de Unfollow</h1>
    <p class="subtitle">Descubra quem n√£o te segue de volta de forma segura.</p>

    <div class="step">
        <div class="step-title"><span class="step-number">1</span> Solicite seus dados no Instagram</div>
        
        <div class="tutorial-list">
            1. Toque no bot√£o abaixo para abrir a Central de Contas.<br>
            2. Escolha <strong>"Baixar ou transferir informa√ß√µes"</strong>.<br>
            3. Selecione <strong>"Algumas de suas informa√ß√µes"</strong>.<br>
            4. Role para baixo at√© a categoria <strong>Conex√µes</strong> e marque apenas <strong>"Seguidores e seguindo"</strong>.<br>
            5. Avance e configure EXATAMENTE assim:
        </div>

        <div class="config-card">
            <div class="config-item">
                <span class="config-label">Destino:</span>
                <span class="config-value">Baixar no dispositivo</span>
            </div>
            <div class="config-item">
                <span class="config-label">Intervalo de datas:</span>
                <span class="config-value">Desde o in√≠cio</span>
            </div>
            <div class="config-item">
                <span class="config-label">Formato:</span>
                <span class="config-value" style="color:#E1306C">JSON (N√£o HTML)</span>
            </div>
        </div>

        <a href="https://accountscenter.instagram.com/info_and_permissions/dyi/" target="_blank" class="btn-insta">‚ÜóÔ∏è Abrir Instagram e Solicitar</a>
    </div>

    <div class="step">
        <div class="step-title"><span class="step-number">2</span> Envie o arquivo recebido</div>
        <p style="font-size: 0.9em; color: #555; margin-bottom: 15px;">O Instagram te enviar√° um email. Baixe o arquivo (ZIP) e envie ele aqui <strong>sem descompactar</strong>.</p>
        
        <div class="upload-zone">
            <p>üìÇ Toque aqui para enviar o arquivo .ZIP</p>
            <input type="file" id="zipFile" accept=".zip" onchange="handleZipUpload(this)">
        </div>
        <div id="loading" class="loading">üîç Lendo arquivo ZIP...</div>
        <div id="errorMsg" class="error-msg"></div>
    </div>

    <div id="results">
        <div class="stats">
            <div class="stat-card">
                <div class="stat-val" id="numFollowers">-</div>
                <div class="stat-label">Te Seguem</div>
            </div>
            <div class="stat-card">
                <div class="stat-val" id="numFollowing">-</div>
                <div class="stat-label">Voc√™ Segue</div>
            </div>
            <div class="stat-card">
                <div class="stat-val" id="numNotBack">-</div>
                <div class="stat-label">N√£o Retornam</div>
            </div>
        </div>

        <h3 style="text-align: left; font-size: 1.1em; color: #333;">üö´ Quem n√£o te segue de volta:</h3>
        <p style="font-size: 0.8em; color: #888; margin-bottom: 10px;">Clique em "Ver Perfil" para conferir.</p>
        <ul id="listNotBack"></ul>
    </div>
</div>

<script>
    // --- L√≥gica JSZip e Processamento ---

    function encontrarListaUsuarios(data) {
        if (Array.isArray(data)) return data;
        if (data.relationships_following) return data.relationships_following;
        if (data.relationships_followers) return data.relationships_followers;
        for (let key in data) {
            if (Array.isArray(data[key])) return data[key];
        }
        return [];
    }

    function extrairUsuarios(data) {
        const users = new Set();
        const lista = encontrarListaUsuarios(data);
        
        lista.forEach(item => {
            let username = null;
            // Tenta achar o username nas estruturas conhecidas
            if (item.string_list_data && item.string_list_data[0] && item.string_list_data[0].value) {
                username = item.string_list_data[0].value;
            } else if (item.title) {
                username = item.title;
            } else if (item.value) {
                username = item.value;
            }
            if (username) users.add(username.toLowerCase());
        });
        return users;
    }

    async function handleZipUpload(input) {
        const file = input.files[0];
        if (!file) return;

        document.getElementById('loading').style.display = 'block';
        document.getElementById('errorMsg').style.display = 'none';
        document.getElementById('results').style.display = 'none';

        try {
            const zip = new JSZip();
            const zipContent = await zip.loadAsync(file);
            
            let followersContent = null;
            let followingContent = null;

            // Busca flex√≠vel dentro do ZIP
            for (const [filename, fileData] of Object.entries(zipContent.files)) {
                if (filename.includes('followers_1.json') || filename.includes('followers.json')) {
                    followersContent = await fileData.async('string');
                }
                if (filename.includes('following.json')) {
                    followingContent = await fileData.async('string');
                }
            }

            if (!followersContent || !followingContent) {
                throw new Error("Arquivos n√£o encontrados no ZIP. Certifique-se de ter escolhido formato JSON no Instagram.");
            }

            const followersJson = JSON.parse(followersContent);
            const followingJson = JSON.parse(followingContent);

            const seguidores = extrairUsuarios(followersJson);
            const seguindo = extrairUsuarios(followingJson);

            const naoSeguemDeVolta = [];
            seguindo.forEach(user => {
                if (!seguidores.has(user)) {
                    naoSeguemDeVolta.push(user);
                }
            });

            // Atualiza Interface
            document.getElementById('numFollowers').innerText = seguidores.size;
            document.getElementById('numFollowing').innerText = seguindo.size;
            document.getElementById('numNotBack').innerText = naoSeguemDeVolta.length;

            const ul = document.getElementById('listNotBack');
            ul.innerHTML = '';
            naoSeguemDeVolta.sort().forEach(user => {
                const li = document.createElement('li');
                li.innerHTML = `<strong>${user}</strong><a href="https://instagram.com/${user}" target="_blank" class="profile-link">Ver Perfil</a>`;
                ul.appendChild(li);
            });

            document.getElementById('loading').style.display = 'none';
            document.getElementById('results').style.display = 'block';

        } catch (err) {
            console.error(err);
            document.getElementById('loading').style.display = 'none';
            document.getElementById('errorMsg').innerText = "Erro: " + err.message;
            document.getElementById('errorMsg').style.display = 'block';
        }
    }
</script>

</body>
</html>
